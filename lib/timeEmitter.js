var util=require("util"),EventEmitter=require("events").EventEmitter;function eventCall(){var a=[];console.log("interval : "+new Date);for(var b in this.items)if(this.items[b].enabled){var c={key:b,data:this.items[b].args};a.push(c);this.emit("item",c)}this.emit("time",a);console.log("@@@@@@@@@ interval Count : "+a.length)}function TimeEmitter(a,b){this.time=1E3*(a-1);this.cycle=1E3*b;this.interval=this.starter=null;this.items={}}util.inherits(TimeEmitter,EventEmitter);
TimeEmitter.prototype.getAllItems=function(){var a=[],b;for(b in this.items)a.push({key:b,data:this.items[b].args,enabled:this.items[b].enabled});return a};TimeEmitter.prototype.getEnableItems=function(){var a=[],b;for(b in this.items)items[b].enabled&&a.push({key:b,data:this.items[b].args});return a};TimeEmitter.prototype.addItem=function(a,b,c){c=c||!0;!1===b.enabled&&(c=!1);delete b.enabled;if(this.items[a])throw Error("Exist Item Key");this.items[a]={args:b,enabled:c}};
TimeEmitter.prototype.updateItem=function(){var a,b,c;b=Array.prototype.slice.call(arguments);a=b.shift();c="boolean"===typeof b[0]?b.shift():null;b="object"===typeof b[0]?b.pop():null;if(this.items[a])b&&(this.items[a].args=b),null!==c&&(this.items[a].enabled=c);else throw Error("Invalid Item Key");};TimeEmitter.prototype.deleteItem=function(a){delete this.items[a]};
TimeEmitter.prototype.start=function(){var a=this;if(this.stater)throw Error("already started");this.starter=setTimeout(function(){console.log(">> Emitter Start -> : "+a.time);delete a.starter;eventCall.call(a);a.interval=setInterval(function(){eventCall.call(a)},a.cycle)},a.time)};TimeEmitter.prototype.destroy=function(){this.starter?(clearTimeout(this.starter),delete this.starter):(clearInterval(this.interval),delete this.interval)};module.exports=TimeEmitter;